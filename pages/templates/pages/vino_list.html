{% extends "base.html" %}
{% load static %}

{% block title %}Selección Boutique{% endblock %}

{% block content %}
<main class="container py-5">
  <section class="text-center mb-4">
    <h1 class="display-4">Selección Boutique</h1>
    <p class="lead">Vinos curados con narrativa sensorial, maridajes y atmósfera editorial.</p>
  </section>

  <!-- 🔍 Filtros sensoriales -->
  <form method="get" class="row mb-5">
    <div class="col-md-4">
      <input type="text" name="varietal" value="{{ varietal }}" class="form-control" placeholder="Varietal">
    </div>
    <div class="col-md-4">
      <input type="number" name="precio_max" value="{{ precio_max }}" class="form-control" placeholder="Precio máximo">
    </div>
    <div class="col-md-4">
      <input type="number" name="añada" value="{{ añada }}" class="form-control" placeholder="Año de cosecha">
    </div>
    <div class="col-12 mt-3">
      <button type="submit" class="btn btn-outline-dark w-100">Filtrar selección</button>
    </div>
  </form>

  <!-- 🍷 Fichas sensoriales -->
  <section class="row">
    {% for vino in vinos %}
      <div class="col-md-4 mb-4">
        <div class="card h-100 shadow-sm">
          {% if vino.imagen %}
            <img src="{{ vino.imagen.url }}" class="card-img-top" alt="{{ vino.nombre }}">
          {% else %}
            <img src="{% static 'pages/img/default_vino.jpg' %}" class="card-img-top" alt="Imagen por defecto">
          {% endif %}
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">{{ vino.nombre }} ({{ vino.añada|date:"Y" }})</h5>
            <p class="card-text"><strong>Varietal:</strong> {{ vino.varietal }}</p>
            <p class="card-text"><strong>Precio:</strong> ${{ vino.precio }}</p>
            <p class="card-text"><strong>Notas:</strong> {{ vino.notas|truncatewords:20 }}</p>
            <p class="card-text"><strong>Maridaje:</strong> {{ vino.maridaje }}</p>

            <div class="mt-auto">
              <a href="{% url 'pages:vino_detail' vino.slug %}" class="btn btn-outline-dark w-100 mb-2">Ver ficha</a>

              <form method="post" action="{% url 'carrito:agregar' vino.slug %}">
                {% csrf_token %}
                <button type="submit" class="btn btn-outline-success w-100">🛒 Agregar al carrito</button>
              </form>
            </div>
          </div>
        </div>
      </div>
    {% empty %}
      <div class="col-12 text-center">
        <p class="text-muted">No hay vinos disponibles con esos filtros.</p>
      </div>
    {% endfor %}
  </section>
  
</main>
{% endblock %}
{% block extra_css %}
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Lato:wght@300;400&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'pages/css/vino_list.css' %}">
{% endblock %}